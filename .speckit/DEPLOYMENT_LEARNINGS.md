# ğŸ“š éƒ¨ç½²å­¸ç¿’ç¸½çµ

**å°ˆæ¡ˆ**: Prompt-Scribe API  
**å­¸ç¿’æ—¥æœŸ**: 2025-10-15  
**éƒ¨ç½²å¹³å°**: Vercel Serverless Functions  
**å­¸ç¿’ç›®æ¨™**: Serverless éƒ¨ç½²æœ€ä½³å¯¦è¸èˆ‡å•é¡Œè§£æ±º

---

## ğŸ¯ æ ¸å¿ƒå­¸ç¿’è¦é»

### 1. Serverless ç’°å¢ƒçš„æœ¬è³ªå·®ç•°

#### æœ¬åœ°é–‹ç™¼ vs Serverless ç”Ÿç”¢ç’°å¢ƒ

**æœ¬åœ°ç’°å¢ƒ**:
```python
# è¤‡é›œæ¨¡çµ„çµæ§‹å¯ä»¥æ­£å¸¸å·¥ä½œ
from src.api.main import app
from config import settings
from services.cache_strategy import get_cache_strategy_manager
```

**Serverless ç’°å¢ƒ**:
```python
# å¿…é ˆæ˜¯è‡ªåŒ…å«çš„ï¼Œç„¡å¤–éƒ¨ä¾è³´
from fastapi import FastAPI
app = FastAPI(title="My API")
# ç›´æ¥åœ¨å…¥å£é»å®šç¾©æ‰€æœ‰å¿…è¦ä»£ç¢¼
```

#### é—œéµæ´å¯Ÿ
- **æ²™ç›’åŒ–**: Serverless ç’°å¢ƒæ˜¯éš”é›¢çš„ï¼Œç„¡æ³•è¨ªå•è¤‡é›œçš„å°ˆæ¡ˆçµæ§‹
- **å†·å•Ÿå‹•**: æ¯æ¬¡è«‹æ±‚å¯èƒ½åœ¨ä¸åŒçš„å¯¦ä¾‹ä¸Šï¼Œç‹€æ…‹ä¸æŒä¹…
- **æª”æ¡ˆé™åˆ¶**: æœ‰åš´æ ¼çš„æª”æ¡ˆå¤§å°å’Œä¾è³´é™åˆ¶

### 2. æ¨¡çµ„å°å…¥éŒ¯èª¤çš„æ ¹æœ¬åŸå› 

#### éŒ¯èª¤æ¨¡å¼åˆ†æ

**å•é¡Œä»£ç¢¼**:
```python
# api/index.py
from api.main import app  # â† é€™è£¡é–‹å§‹å‡ºéŒ¯
```

**éŒ¯èª¤éˆ**:
1. `api/index.py` å°å…¥ `src/api/main.py`
2. `main.py` å°å…¥ `from config import settings`
3. `config.py` åœ¨ Vercel ç’°å¢ƒä¸­æ‰¾ä¸åˆ°
4. `ModuleNotFoundError: No module named 'config'`

#### è§£æ±ºæ–¹æ¡ˆæ¼”é€²

**å˜—è©¦ 1**: è·¯å¾‘ä¿®æ­£
```python
sys.path.insert(0, str(src_path))
# ä»ç„¶å¤±æ•—ï¼šç’°å¢ƒå·®ç•°
```

**å˜—è©¦ 2**: é‹è¡Œæ™‚é…ç½®
```json
{
  "runtime": "@vercel/python@2.0.3"
}
// ä»ç„¶å¤±æ•—ï¼šç‰ˆæœ¬å•é¡Œ
```

**æœ€çµ‚æ–¹æ¡ˆ**: è‡ªåŒ…å«å…¥å£é»
```python
# api/index.py - å®Œå…¨è‡ªåŒ…å«
from fastapi import FastAPI
app = FastAPI()
# ä¸ä¾è³´ä»»ä½•å¤–éƒ¨æ¨¡çµ„
```

### 3. Vercel éƒ¨ç½²é…ç½®æœ€ä½³å¯¦è¸

#### é…ç½®æ¼”é€²éç¨‹

**åˆå§‹é…ç½®ï¼ˆå¤±æ•—ï¼‰**:
```json
{
  "builds": [...],
  "functions": {...},  // â† è¡çª
  "regions": ["all"]   // â† å…è²»æ–¹æ¡ˆä¸æ”¯æ´
}
```

**æœ€çµ‚é…ç½®ï¼ˆæˆåŠŸï¼‰**:
```json
{
  "builds": [{
    "src": "api/index.py",
    "use": "@vercel/python"
  }],
  "routes": [{
    "src": "/(.*)",
    "dest": "api/index.py"
  }]
}
```

#### é—œéµé…ç½®è¦é»
- **å–®ä¸€é…ç½®**: ä¸è¦åŒæ™‚ä½¿ç”¨ `builds` å’Œ `functions`
- **å…è²»é™åˆ¶**: å…è²»æ–¹æ¡ˆä¸æ”¯æ´å¤šå€åŸŸéƒ¨ç½²
- **æª”æ¡ˆéæ¿¾**: ä½¿ç”¨ `.vercelignore` æ’é™¤å¤§å‹æª”æ¡ˆ

---

## ğŸ”§ æŠ€è¡“å•é¡Œè§£æ±ºæµç¨‹

### å•é¡Œè¨ºæ–·æ–¹æ³•

#### 1. éŒ¯èª¤åˆ†é¡
```
FUNCTION_INVOCATION_FAILED
â”œâ”€â”€ æ¨¡çµ„å°å…¥éŒ¯èª¤ (ModuleNotFoundError)
â”œâ”€â”€ é‹è¡Œæ™‚é…ç½®éŒ¯èª¤ (Invalid runtime)
â”œâ”€â”€ æª”æ¡ˆå¤§å°éŒ¯èª¤ (File size limit)
â””â”€â”€ ç’°å¢ƒè®Šæ•¸éŒ¯èª¤ (Missing environment)
```

#### 2. é€æ­¥æ’æŸ¥
1. **æª¢æŸ¥æ—¥èªŒ**: `vercel logs <deployment-url>`
2. **ç°¡åŒ–å…¥å£é»**: ç§»é™¤è¤‡é›œä¾è³´
3. **ç’°å¢ƒè®Šæ•¸**: ç¢ºä¿æ‰€æœ‰å¿…è¦çš„ç’°å¢ƒè®Šæ•¸å·²è¨­ç½®
4. **é…ç½®é©—è­‰**: æª¢æŸ¥ `vercel.json` èªæ³•

#### 3. è¿­ä»£ä¿®å¾©
- **å°æ­¥å¿«è·‘**: æ¯æ¬¡åªä¿®å¾©ä¸€å€‹å•é¡Œ
- **é©—è­‰çµæœ**: æ¯æ¬¡ä¿®å¾©å¾Œç«‹å³æ¸¬è©¦
- **è¨˜éŒ„éç¨‹**: è¨˜éŒ„æ¯æ¬¡å˜—è©¦å’Œçµæœ

### éƒ¨ç½²å˜—è©¦è¨˜éŒ„

| å˜—è©¦ | å•é¡Œ | è§£æ±ºæ–¹æ¡ˆ | å­¸ç¿’é» |
|------|------|----------|--------|
| 1 | builds + functions è¡çª | ç§»é™¤ functions | é…ç½®è¡çªæª¢æ¸¬ |
| 2 | å¤šå€åŸŸéƒ¨ç½²é™åˆ¶ | ç§»é™¤ regions | å…è²»æ–¹æ¡ˆé™åˆ¶ |
| 3 | æª”æ¡ˆå¤§å°è¶…é™ | å‰µå»º .vercelignore | æª”æ¡ˆéæ¿¾ç­–ç•¥ |
| 4 | ç’°å¢ƒè®Šæ•¸å¼•ç”¨éŒ¯èª¤ | ä¿®æ­£ vercel.json | ç’°å¢ƒè®Šæ•¸ç®¡ç† |
| 5 | Python é‹è¡Œæ™‚ç‰ˆæœ¬ | æ›´æ–°ç‚º @vercel/python | é‹è¡Œæ™‚å…¼å®¹æ€§ |
| 6 | æ¨¡çµ„å°å…¥éŒ¯èª¤ | å‰µå»ºç°¡åŒ–å…¥å£é» | **æ ¸å¿ƒå­¸ç¿’** |

---

## ğŸ“ æœ€ä½³å¯¦è¸ç¸½çµ

### Serverless éƒ¨ç½²åŸå‰‡

#### 1. **è‡ªåŒ…å«æ€§åŸå‰‡**
```python
# âœ… å¥½çš„æ¨¡å¼
from fastapi import FastAPI
from pydantic import BaseModel

app = FastAPI()
# ç›´æ¥åœ¨å…¥å£é»å®šç¾©æ‰€æœ‰ä»£ç¢¼

# âŒ é¿å…çš„æ¨¡å¼
from complex.module import something
from config import settings
# è¤‡é›œçš„æ¨¡çµ„å°å…¥
```

#### 2. **ç’°å¢ƒå·®ç•°è™•ç†**
```python
# âœ… ç’°å¢ƒé©æ‡‰æ€§ä»£ç¢¼
import os
database_url = os.getenv("DATABASE_URL", "default_value")

# âŒ ç¡¬ç·¨ç¢¼é…ç½®
database_url = "hardcoded://localhost:5432"
```

#### 3. **æœ€å°åŒ–ä¾è³´**
```python
# âœ… æœ€å°ä¾è³´
from fastapi import FastAPI
import httpx  # æ¨™æº–åº«æˆ–æ˜ç¢ºå®‰è£çš„åŒ…

# âŒ è¤‡é›œä¾è³´
from myproject.services.cache import CacheManager
from myproject.utils.helpers import complex_helper
```

### é…ç½®ç®¡ç†æœ€ä½³å¯¦è¸

#### 1. **ç’°å¢ƒè®Šæ•¸ç­–ç•¥**
- ä½¿ç”¨å¹³å°åŸç”Ÿçš„ç’°å¢ƒè®Šæ•¸ç®¡ç†
- ä¸è¦å°‡æ•æ„Ÿä¿¡æ¯æäº¤åˆ°ä»£ç¢¼åº«
- ç‚ºä¸åŒç’°å¢ƒå‰µå»ºä¸åŒçš„é…ç½®

#### 2. **æª”æ¡ˆçµæ§‹å„ªåŒ–**
```
å°ˆæ¡ˆæ ¹ç›®éŒ„/
â”œâ”€â”€ api/           # Serverless å…¥å£é»
â”‚   â””â”€â”€ index.py   # è‡ªåŒ…å«çš„ FastAPI æ‡‰ç”¨
â”œâ”€â”€ src/           # å®Œæ•´æ‡‰ç”¨ä»£ç¢¼ï¼ˆç”¨æ–¼å…¶ä»–éƒ¨ç½²ï¼‰
â”œâ”€â”€ vercel.json    # Vercel é…ç½®
â””â”€â”€ .vercelignore  # æª”æ¡ˆéæ¿¾
```

#### 3. **éŒ¯èª¤è™•ç†ç­–ç•¥**
```python
# âœ… å„ªé›…çš„éŒ¯èª¤è™•ç†
try:
    from optional_module import something
    FEATURE_AVAILABLE = True
except ImportError:
    FEATURE_AVAILABLE = False
    logger.warning("Optional feature not available")

# âŒ ç¡¬æ€§ä¾è³´
from required_module import something  # å¦‚æœä¸å­˜åœ¨å°±å´©æ½°
```

---

## ğŸš€ æœªä¾†æ”¹é€²æ–¹å‘

### çŸ­æœŸæ”¹é€²ï¼ˆ1-2 é€±ï¼‰

#### 1. **åŠŸèƒ½æ“´å±•**
- å°‡ `src/api/routers/` ä¸­çš„åŠŸèƒ½é·ç§»åˆ° Vercel
- æ·»åŠ  Supabase æ•¸æ“šåº«é›†æˆ
- å¯¦ç¾å®Œæ•´çš„ API ç«¯é»

#### 2. **ç›£æ§èˆ‡æ—¥èªŒ**
- é…ç½® Vercel Analytics
- è¨­ç½®éŒ¯èª¤è¿½è¹¤
- å¯¦ç¾æ€§èƒ½ç›£æ§

### ä¸­æœŸæ”¹é€²ï¼ˆ1-2 å€‹æœˆï¼‰

#### 1. **æ¶æ§‹å„ªåŒ–**
- è©•ä¼°å¾®æœå‹™æ¶æ§‹
- è€ƒæ…®å¤šå¹³å°éƒ¨ç½²ï¼ˆRailway å‚™ä»½ï¼‰
- å¯¦ç¾è‡ªå‹•åŒ– CI/CD

#### 2. **æ€§èƒ½å„ªåŒ–**
- å¯¦ç¾ Redis å¿«å–ï¼ˆéœ€è¦ä»˜è²»æ–¹æ¡ˆï¼‰
- å„ªåŒ–å†·å•Ÿå‹•æ™‚é–“
- æ·»åŠ  CDN é…ç½®

### é•·æœŸè¦åŠƒï¼ˆ3-6 å€‹æœˆï¼‰

#### 1. **å¯æ“´å±•æ€§**
- å¤šå€åŸŸéƒ¨ç½²
- è² è¼‰å‡è¡¡
- è‡ªå‹•æ“´å±•

#### 2. **åŠŸèƒ½å®Œæ•´æ€§**
- å®Œæ•´çš„ LLM é›†æˆ
- é«˜ç´šå¿«å–ç­–ç•¥
- å¯¦æ™‚ç›£æ§å„€è¡¨æ¿

---

## ğŸ“– ç›¸é—œè³‡æº

### å®˜æ–¹æ–‡æª”
- [Vercel Python Runtime](https://vercel.com/docs/functions/serverless-functions/runtimes/python)
- [FastAPI Deployment](https://fastapi.tiangolo.com/deployment/)
- [Serverless Functions Best Practices](https://vercel.com/docs/functions/serverless-functions)

### å­¸ç¿’è³‡æº
- [Serverless Architecture Patterns](https://serverlessland.com/patterns)
- [Python Packaging Best Practices](https://packaging.python.org/en/latest/)
- [Environment Variables Management](https://12factor.net/config)

---

## ğŸ¯ é—œéµæ”¶ç©«

### æŠ€è¡“æ”¶ç©«
1. **Serverless ç’°å¢ƒç†è§£**: æ·±å…¥ç†è§£ Serverless çš„é™åˆ¶å’Œå„ªå‹¢
2. **æ¨¡çµ„åŒ–è¨­è¨ˆ**: å­¸æœƒç‚ºä¸åŒéƒ¨ç½²ç’°å¢ƒè¨­è¨ˆä¸åŒçš„å…¥å£é»
3. **å•é¡Œè§£æ±ºæµç¨‹**: å»ºç«‹ç³»çµ±æ€§çš„éƒ¨ç½²å•é¡Œè¨ºæ–·å’Œè§£æ±ºæµç¨‹

### æµç¨‹æ”¶ç©«
1. **è¿­ä»£ä¿®å¾©**: å°æ­¥å¿«è·‘ï¼Œé€æ­¥è§£æ±ºå•é¡Œ
2. **æ–‡æª”è¨˜éŒ„**: è©³ç´°è¨˜éŒ„æ¯æ¬¡å˜—è©¦å’Œçµæœ
3. **å­¸ç¿’å°å‘**: å°‡æ¯æ¬¡éŒ¯èª¤è½‰åŒ–ç‚ºå­¸ç¿’æ©Ÿæœƒ

### å¿ƒæ…‹æ”¶ç©«
1. **è€å¿ƒèˆ‡å …æŒ**: éƒ¨ç½²æ˜¯ä¸€å€‹è¿­ä»£éç¨‹ï¼Œéœ€è¦è€å¿ƒ
2. **ç³»çµ±æ€§æ€è€ƒ**: å¾æ¶æ§‹å±¤é¢ç†è§£å•é¡Œçš„æ ¹æœ¬åŸå› 
3. **æœ€ä½³å¯¦è¸**: å»ºç«‹å¯é‡ç”¨çš„éƒ¨ç½²æ¨¡å¼å’Œæµç¨‹

---

**ç¸½çµ**: é€™æ¬¡éƒ¨ç½²ç¶“æ­·è®“æˆ‘å€‘æ·±åˆ»ç†è§£äº† Serverless ç’°å¢ƒçš„ç‰¹æ®Šæ€§ï¼Œå­¸æœƒäº†å¦‚ä½•ç‚ºä¸åŒçš„éƒ¨ç½²å¹³å°è¨­è¨ˆé©åˆçš„æ¶æ§‹ã€‚æœ€é‡è¦çš„æ˜¯ï¼Œæˆ‘å€‘å»ºç«‹äº†ç³»çµ±æ€§çš„å•é¡Œè§£æ±ºæµç¨‹ï¼Œé€™å°‡åœ¨æœªä¾†çš„éƒ¨ç½²ä¸­ç™¼æ®é‡è¦ä½œç”¨ã€‚

> "æ¯ä¸€æ¬¡éƒ¨ç½²å¤±æ•—éƒ½æ˜¯ä¸€æ¬¡å­¸ç¿’æ©Ÿæœƒï¼Œæ¯ä¸€æ¬¡æˆåŠŸéƒ½æ˜¯ä¸‹ä¸€æ¬¡æŒ‘æˆ°çš„èµ·é»ã€‚"
