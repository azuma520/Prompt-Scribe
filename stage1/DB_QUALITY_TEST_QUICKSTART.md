# è³‡æ–™åº«å“è³ªæ¸¬è©¦ - å¿«é€Ÿé–‹å§‹æŒ‡å—

**ç‰ˆæœ¬**: v1.0  
**å‰µå»ºæ—¥æœŸ**: 2025-10-13  
**é©ç”¨æ–¼**: Plan C Phase 3 å®Œæˆå¾Œçš„è³‡æ–™åº«é©—è­‰

---

## ğŸ“‹ ç›®éŒ„

1. [ç’°å¢ƒè¦æ±‚](#ç’°å¢ƒè¦æ±‚)
2. [å¿«é€Ÿé–‹å§‹](#å¿«é€Ÿé–‹å§‹)
3. [ä½¿ç”¨èªªæ˜](#ä½¿ç”¨èªªæ˜)
4. [è¼¸å‡ºè§£è®€](#è¼¸å‡ºè§£è®€)
5. [å¸¸è¦‹å•é¡Œ](#å¸¸è¦‹å•é¡Œ)

---

## ç’°å¢ƒè¦æ±‚

### å¿…éœ€
- **Python**: 3.8+
- **SQLite3**: 3.8.3+ï¼ˆPython æ¨™æº–åº«ï¼‰
- **è³‡æ–™åº«**: `output/tags.db`ï¼ˆPlan C Phase 3 å®Œæˆå¾Œï¼‰

### å¯é¸
- **Pandas**: ç”¨æ–¼é€²éšæ•¸æ“šåˆ†æï¼ˆéå¿…éœ€ï¼‰

### ç¢ºèªç’°å¢ƒ
```bash
# æª¢æŸ¥ Python ç‰ˆæœ¬
python --version  # æ‡‰è©² >= 3.8

# æª¢æŸ¥ SQLite3 ç‰ˆæœ¬
python -c "import sqlite3; print(f'SQLite: {sqlite3.sqlite_version}')"  # æ‡‰è©² >= 3.8.3

# ç¢ºèªè³‡æ–™åº«å­˜åœ¨
ls output/tags.db
```

---

## å¿«é€Ÿé–‹å§‹

### 1. åŸ·è¡Œæ‰€æœ‰æ¸¬è©¦ï¼ˆæ¨è–¦ï¼‰

```bash
cd stage1
python db_quality_test.py
```

**é æœŸè¼¸å‡º**:
```
2025-10-13 15:00:00 - INFO - è¼‰å…¥æ¸¬è©¦å ´æ™¯...
2025-10-13 15:00:00 - INFO - æˆåŠŸè¼‰å…¥ 10 å€‹æ¸¬è©¦å ´æ™¯
2025-10-13 15:00:00 - INFO - ================================================================================
2025-10-13 15:00:00 - INFO - é–‹å§‹åŸ·è¡Œè³‡æ–™åº«å“è³ªæ¸¬è©¦
2025-10-13 15:00:00 - INFO - ================================================================================

[1/10] åŸ·è¡Œå ´æ™¯ A1: ä¸»åˆ†é¡è¦†è“‹åº¦æ¸¬è©¦
------------------------------------------------------------
çµæœ: [PASS] (åŸ·è¡Œæ™‚é–“: 0.052s)

[... å…¶ä»–å ´æ™¯ ...]

================================================================================
æ‰€æœ‰æ¸¬è©¦åŸ·è¡Œå®Œæˆ
================================================================================

ç”Ÿæˆæ¸¬è©¦å ±å‘Š...
Markdown å ±å‘Šå·²ç”Ÿæˆ: output/DB_QUALITY_TEST_REPORT.md

================================================================================
æ¸¬è©¦æ‘˜è¦
================================================================================
ç¸½å ´æ™¯: 10
é€šé: 8
è­¦å‘Š: 1
å¤±æ•—: 1
éŒ¯èª¤: 0
ç¸½å•é¡Œæ•¸: 5
åŸ·è¡Œæ™‚é–“: 2.34 ç§’
================================================================================
```

### 2. æŸ¥çœ‹æ¸¬è©¦å ±å‘Š

```bash
# Windows
type output\DB_QUALITY_TEST_REPORT.md

# Linux/Mac
cat output/DB_QUALITY_TEST_REPORT.md
```

---

## ä½¿ç”¨èªªæ˜

### åŸ·è¡Œæ¨¡å¼

#### æ¨¡å¼ 1: åŸ·è¡Œæ‰€æœ‰æ¸¬è©¦ï¼ˆé»˜èªï¼‰
```bash
python db_quality_test.py
```

#### æ¨¡å¼ 2: åŸ·è¡Œç‰¹å®šå ´æ™¯
```bash
# åŸ·è¡Œå–®ä¸€å ´æ™¯
python db_quality_test.py --scenario A1

# å ´æ™¯ ID:
# A1: ä¸»åˆ†é¡è¦†è“‹åº¦
# A2: é »ç‡æ®µè¦†è“‹åº¦
# A3: Danbooru è½‰æ›
# B1: å‰¯åˆ†é¡æº–ç¢ºæ€§
# B2: ä¿¡å¿ƒåº¦åˆ†å¸ƒ
# B3: é‚Šç•Œæ¡ˆä¾‹
# C1: æ¨¡å¼ä¸€è‡´æ€§
# C2: ä¾†æºå“è³ª
# D1: æŸ¥è©¢æ€§èƒ½
# E1: Prompt ç”Ÿæˆ
```

#### æ¨¡å¼ 3: åŸ·è¡Œç‰¹å®šç¶­åº¦
```bash
# åªåŸ·è¡Œå®Œæ•´æ€§æ¸¬è©¦
python db_quality_test.py --dimension Completeness

# ç¶­åº¦é¸é …:
# Completeness: å®Œæ•´æ€§æ¸¬è©¦ (A1-A3)
# Accuracy: æº–ç¢ºæ€§æ¸¬è©¦ (B1-B3)
# Consistency: ä¸€è‡´æ€§æ¸¬è©¦ (C1-C2)
# Performance: æ€§èƒ½æ¸¬è©¦ (D1)
# Application: æ‡‰ç”¨æ¸¬è©¦ (E1)
```

### å ±å‘Šæ ¼å¼

#### Markdown å ±å‘Šï¼ˆé»˜èªï¼‰
```bash
python db_quality_test.py --format markdown
```
è¼¸å‡º: `output/DB_QUALITY_TEST_REPORT.md`

#### JSON å ±å‘Š
```bash
python db_quality_test.py --format json
```
è¼¸å‡º: `output/test_results.json`

#### åŒæ™‚ç”Ÿæˆå…©ç¨®æ ¼å¼
```bash
python db_quality_test.py --format both
```

### å…¶ä»–é¸é …

```bash
# è©³ç´°è¼¸å‡ºæ¨¡å¼
python db_quality_test.py --verbose

# æŒ‡å®šè³‡æ–™åº«è·¯å¾‘
python db_quality_test.py --db /path/to/tags.db

# æŒ‡å®šè¼¸å‡ºç›®éŒ„
python db_quality_test.py --output /path/to/output
```

---

## è¼¸å‡ºè§£è®€

### æ¸¬è©¦ç‹€æ…‹

| ç‹€æ…‹ | åœ–æ¨™ | å«ç¾© |
|------|------|------|
| **PASS** | âœ… | æ‰€æœ‰æˆåŠŸæ¨™æº–éƒ½æ»¿è¶³ |
| **WARN** | âš ï¸ | å¤§éƒ¨åˆ†æ»¿è¶³ï¼Œæœ‰å°å•é¡Œï¼ˆP2 ç´šåˆ¥ï¼‰ |
| **FAIL** | âŒ | æœªæ»¿è¶³é—œéµæˆåŠŸæ¨™æº–ï¼ˆP0/P1 å•é¡Œï¼‰ |
| **ERROR** | ğŸ”´ | åŸ·è¡Œæ™‚ç™¼ç”ŸéŒ¯èª¤ |

### å•é¡Œåš´é‡ç¨‹åº¦

| ç´šåˆ¥ | å«ç¾© | å»ºè­° |
|------|------|------|
| **P0** | å¿…é ˆä¿®å¾© | é˜»ç¤™ Stage 2 é€²è¡Œ |
| **P1** | å»ºè­°ä¿®å¾© | æ‡‰è©²åœ¨ Stage 2 å‰è™•ç† |
| **P2** | å¯é¸å„ªåŒ– | å¯ä»¥åœ¨å¾ŒçºŒæ”¹é€² |

### å ±å‘Šçµæ§‹

```markdown
# è³‡æ–™åº«å“è³ªæ¸¬è©¦å ±å‘Š

## åŸ·è¡Œæ‘˜è¦
- æ•´é«”æ¸¬è©¦çµæœçµ±è¨ˆ

## è©³ç´°çµæœ
### A çµ„: æ•¸æ“šå®Œæ•´æ€§
#### A1: ä¸»åˆ†é¡è¦†è“‹åº¦ âœ…
- ç‹€æ…‹ã€åŸ·è¡Œæ™‚é–“ã€é—œéµæŒ‡æ¨™ã€ç™¼ç¾å•é¡Œ

[... å…¶ä»–å ´æ™¯ ...]

## å•é¡Œç¸½çµ
### P0 å•é¡Œï¼ˆå¿…é ˆä¿®å¾©ï¼‰
1. [å ´æ™¯ ID] å•é¡Œæè¿°
   - å—å½±éŸ¿æ¨™ç±¤
   - ä¿®å¾©å»ºè­°

### P1 å•é¡Œï¼ˆå»ºè­°ä¿®å¾©ï¼‰
...

## ä¿®å¾©å»ºè­°
- å…·é«”çš„ä¿®å¾©æ­¥é©Ÿå’Œå»ºè­°
```

---

## å¸¸è¦‹å•é¡Œ

### Q1: Unicode ç·¨ç¢¼éŒ¯èª¤
**å•é¡Œ**: `UnicodeEncodeError: 'cp950' codec can't encode character...`

**è§£æ±ºæ–¹æ¡ˆ**:
```bash
# æ–¹æ³• 1: é‡å®šå‘è¼¸å‡ºåˆ°æ–‡ä»¶
python db_quality_test.py > test_output.txt

# æ–¹æ³• 2: åªçœ‹å ±å‘Šæ–‡ä»¶ï¼ˆä¸çœ‹çµ‚ç«¯è¼¸å‡ºï¼‰
python db_quality_test.py
type output\DB_QUALITY_TEST_REPORT.md
```

### Q2: æ‰¾ä¸åˆ°è³‡æ–™åº«æ–‡ä»¶
**å•é¡Œ**: `FileNotFoundError: è³‡æ–™åº«æ–‡ä»¶ä¸å­˜åœ¨`

**è§£æ±ºæ–¹æ¡ˆ**:
```bash
# ç¢ºèªç•¶å‰ç›®éŒ„
pwd  # æ‡‰è©²åœ¨ stage1/

# ç¢ºèªè³‡æ–™åº«å­˜åœ¨
ls output/tags.db

# æˆ–æŒ‡å®šå®Œæ•´è·¯å¾‘
python db_quality_test.py --db D:\Prompt-Scribe\stage1\output\tags.db
```

### Q3: æ¸¬è©¦å ´æ™¯æœªè¼‰å…¥
**å•é¡Œ**: `æœªæ‰¾åˆ°ä»»ä½•æ¸¬è©¦å ´æ™¯`

**è§£æ±ºæ–¹æ¡ˆ**:
```bash
# ç¢ºèªæ¸¬è©¦æ¨¡çµ„å­˜åœ¨
ls test_scenarios/

# æ‡‰è©²åŒ…å«:
# - __init__.py
# - base.py
# - completeness_tests.py
# - accuracy_tests.py
# - consistency_tests.py
# - performance_tests.py
# - application_tests.py
```

### Q4: CTE ä¸æ”¯æŒéŒ¯èª¤
**å•é¡Œ**: `near "WITH": syntax error`

**è§£æ±ºæ–¹æ¡ˆ**:
- å‡ç´š SQLite3 åˆ° 3.8.3+
- æˆ–ä¿®æ”¹æŸ¥è©¢ç§»é™¤ WITH å­å¥

### Q5: å¦‚ä½•åªæ¸¬è©¦è¦†è“‹ç‡ï¼Ÿ
**ç­”æ¡ˆ**:
```bash
python db_quality_test.py --dimension Completeness
```

---

## é€²éšä½¿ç”¨

### è‡ªå‹•åŒ–åŸ·è¡Œ
```bash
# å‰µå»ºæ‰¹æ¬¡è…³æœ¬
cat > run_db_test.bat << EOF
@echo off
cd stage1
python db_quality_test.py --format both
type output\DB_QUALITY_TEST_REPORT.md
pause
EOF

# åŸ·è¡Œ
run_db_test.bat
```

### å®šæœŸç›£æ§
```bash
# æ¯æ¬¡å„ªåŒ–å¾ŒåŸ·è¡Œ
python db_quality_test.py
git add output/DB_QUALITY_TEST_REPORT.md
git commit -m "test: Update quality test results"
```

### æ•´åˆåˆ°å·¥ä½œæµ
```bash
# Stage 2 å‰çš„æª¢æŸ¥
if python db_quality_test.py; then
    echo "å“è³ªæª¢æŸ¥é€šéï¼Œå¯ä»¥é€²å…¥ Stage 2"
else
    echo "å“è³ªæª¢æŸ¥æœªé€šéï¼Œè«‹æª¢æŸ¥å ±å‘Š"
    exit 1
fi
```

---

## æ¸¬è©¦å ´æ™¯èªªæ˜

### A çµ„: æ•¸æ“šå®Œæ•´æ€§
- **A1**: æ‰€æœ‰ 17 å€‹ä¸»åˆ†é¡éƒ½æœ‰æ¨™ç±¤å—ï¼Ÿ
- **A2**: å„é »ç‡æ®µè¦†è“‹ç‡é”æ¨™å—ï¼Ÿ
- **A3**: Danbooru åˆ†é¡æ­£ç¢ºè½‰æ›äº†å—ï¼Ÿ

### B çµ„: åˆ†é¡æº–ç¢ºæ€§
- **B1**: å‰¯åˆ†é¡é‚è¼¯æ­£ç¢ºå—ï¼Ÿï¼ˆçœ¼ç›åœ¨ BODY_PARTSï¼Œé ­é«®åœ¨ HAIRï¼‰
- **B2**: ä¿¡å¿ƒåº¦åˆ†å¸ƒåˆç†å—ï¼Ÿ
- **B3**: é‚Šç•Œæ¡ˆä¾‹è™•ç†æ­£ç¢ºå—ï¼Ÿï¼ˆNULLã€æˆäººå…§å®¹ï¼‰

### C çµ„: æ•¸æ“šä¸€è‡´æ€§
- **C1**: ç›¸ä¼¼æ¨™ç±¤åˆ†é¡ä¸€è‡´å—ï¼Ÿï¼ˆæ‰€æœ‰ *_eyes éƒ½åŒåˆ†é¡ï¼‰
- **C2**: ä¸åŒåˆ†é¡ä¾†æºå“è³ªç©©å®šå—ï¼Ÿ

### D çµ„: æŸ¥è©¢æ€§èƒ½
- **D1**: æŸ¥è©¢é€Ÿåº¦æ»¿è¶³å¯¦æ™‚éœ€æ±‚å—ï¼Ÿ

### E çµ„: å¯¦éš›æ‡‰ç”¨
- **E1**: èƒ½æ”¯æŒå®Œæ•´çš„ Prompt ç”Ÿæˆå—ï¼Ÿ

---

## å¿«é€Ÿæ•…éšœæ’é™¤

| å•é¡Œ | å¯èƒ½åŸå›  | è§£æ±ºæ–¹æ¡ˆ |
|------|---------|---------|
| æ‰¾ä¸åˆ°æ¨¡çµ„ | Python è·¯å¾‘å•é¡Œ | ç¢ºä¿åœ¨ stage1/ ç›®éŒ„åŸ·è¡Œ |
| ç·¨ç¢¼éŒ¯èª¤ | Windows cp950 ç·¨ç¢¼ | æŸ¥çœ‹æ–‡ä»¶å ±å‘Šï¼Œä¸çœ‹çµ‚ç«¯ |
| æŸ¥è©¢è¶…æ™‚ | è³‡æ–™åº«éå¤§ | æ­£å¸¸ç¾è±¡ï¼Œç­‰å¾…å®Œæˆ |
| å ±å‘Šæœªç”Ÿæˆ | åŸ·è¡Œå¤±æ•— | æª¢æŸ¥éŒ¯èª¤è¨Šæ¯ï¼Œä¿®å¾©å¾Œé‡è©¦ |

---

## ä¸‹ä¸€æ­¥

åŸ·è¡Œæ¸¬è©¦å¾Œï¼š

1. **æŸ¥çœ‹å ±å‘Š**: `output/DB_QUALITY_TEST_REPORT.md`
2. **æª¢æŸ¥å•é¡Œ**: æŸ¥çœ‹ P0/P1 å•é¡Œæ¸…å–®
3. **åŸ·è¡Œä¿®å¾©**: æ ¹æ“šå»ºè­°ä¿®å¾©å•é¡Œ
4. **é‡æ–°æ¸¬è©¦**: ç¢ºèªä¿®å¾©æ•ˆæœ
5. **é€²å…¥ Stage 2**: å“è³ªé©—è­‰é€šéå¾Œ

---

**æ–‡æª”ç‰ˆæœ¬**: v1.0  
**æœ€å¾Œæ›´æ–°**: 2025-10-13  
**ç¶­è­·è€…**: Prompt-Scribe Team  
**æ”¯æŒ**: æŸ¥çœ‹ `.specify/specs/db-quality-test-spec.md` ç²å–å®Œæ•´è¦æ ¼

