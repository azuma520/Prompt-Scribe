# è³‡æ–™åº«éƒ¨ç½²ç­–ç•¥

**ç‰ˆæœ¬**: v1.0  
**æ—¥æœŸ**: 2025-10-13  
**ç‹€æ…‹**: ç”Ÿç”¢å°±ç·’  

---

## ğŸ“‹ éƒ¨ç½²æ¦‚è¿°

### ç•¶å‰ç‹€æ…‹
- **è³‡æ–™åº«å“è³ª**: ç”Ÿç”¢å°±ç·’ (96.56% è¦†è“‹ç‡)
- **æ¸¬è©¦é€šéç‡**: 80% (8/10)
- **æ ¸å¿ƒåŠŸèƒ½**: å®Œæ•´å¯ç”¨
- **æ€§èƒ½è¡¨ç¾**: <30ms æŸ¥è©¢éŸ¿æ‡‰

### éƒ¨ç½²ç›®æ¨™
- å®‰å…¨ã€ç©©å®šåœ°å°‡è³‡æ–™åº«éƒ¨ç½²åˆ°ç”Ÿç”¢ç’°å¢ƒ
- ç¢ºä¿é›¶åœæ©Ÿæ™‚é–“æˆ–æœ€å°åœæ©Ÿæ™‚é–“
- å»ºç«‹ç›£æ§å’Œå›æ»¾æ©Ÿåˆ¶
- æä¾›å®Œæ•´çš„éƒ¨ç½²æ–‡æª”

---

## ğŸ¯ éƒ¨ç½²ç­–ç•¥é¸é …

### é¸é … A: è—ç¶ éƒ¨ç½² (æ¨è–¦)
**é©ç”¨å ´æ™¯**: æœ‰å®Œæ•´å‚™ä»½å’Œå›æ»¾èƒ½åŠ›
**å„ªé»**: é›¶åœæ©Ÿæ™‚é–“ï¼Œå¿«é€Ÿå›æ»¾
**ç¼ºé»**: éœ€è¦é¡å¤–è³‡æº

### é¸é … B: æ»¾å‹•æ›´æ–°
**é©ç”¨å ´æ™¯**: è³‡æºæœ‰é™ï¼Œå¯æ¥å—çŸ­æš«åœæ©Ÿ
**å„ªé»**: è³‡æºæ•ˆç‡é«˜
**ç¼ºé»**: æœ‰çŸ­æš«åœæ©Ÿæ™‚é–“

### é¸é … C: é‡‘çµ²é›€éƒ¨ç½²
**é©ç”¨å ´æ™¯**: éœ€è¦æ¼¸é€²å¼é©—è­‰
**å„ªé»**: é¢¨éšªæœ€ä½ï¼Œå¯é€æ­¥é©—è­‰
**ç¼ºé»**: éƒ¨ç½²æ™‚é–“è¼ƒé•·

---

## ğŸš€ æ¨è–¦éƒ¨ç½²æ–¹æ¡ˆ

### éšæ®µ 1: é éƒ¨ç½²æº–å‚™
1. **å‚™ä»½ç¾æœ‰è³‡æ–™åº«**
   ```bash
   # å‰µå»ºå®Œæ•´å‚™ä»½
   cp output/tags.db output/tags_backup_$(date +%Y%m%d_%H%M%S).db
   ```

2. **ç’°å¢ƒé©—è­‰**
   - æª¢æŸ¥ç›®æ¨™ç’°å¢ƒè³‡æº
   - é©—è­‰ç¶²è·¯é€£æ¥
   - ç¢ºèªæ¬Šé™è¨­ç½®

3. **éƒ¨ç½²åŒ…æº–å‚™**
   - è³‡æ–™åº«æ–‡ä»¶ (`output/tags.db`)
   - æ¸¬è©¦å·¥å…·å¥—ä»¶
   - ç›£æ§è…³æœ¬
   - å›æ»¾è…³æœ¬

### éšæ®µ 2: éƒ¨ç½²åŸ·è¡Œ
1. **éƒ¨ç½²æ–°è³‡æ–™åº«**
   ```bash
   # åœæ­¢æ‡‰ç”¨æœå‹™
   systemctl stop prompt-scribe-app
   
   # å‚™ä»½ç¾æœ‰è³‡æ–™åº«
   cp /var/lib/prompt-scribe/tags.db /var/lib/prompt-scribe/tags_backup.db
   
   # éƒ¨ç½²æ–°è³‡æ–™åº«
   cp output/tags.db /var/lib/prompt-scribe/tags.db
   
   # è¨­ç½®æ¬Šé™
   chown prompt-scribe:prompt-scribe /var/lib/prompt-scribe/tags.db
   chmod 644 /var/lib/prompt-scribe/tags.db
   
   # å•Ÿå‹•æ‡‰ç”¨æœå‹™
   systemctl start prompt-scribe-app
   ```

2. **å³æ™‚é©—è­‰**
   ```bash
   # é‹è¡Œå¿«é€Ÿå¥åº·æª¢æŸ¥
   python stage1/quick_health_check.py
   
   # é©—è­‰é—œéµåŠŸèƒ½
   python stage1/validate_core_functions.py
   ```

### éšæ®µ 3: éƒ¨ç½²å¾Œé©—è­‰
1. **åŠŸèƒ½æ¸¬è©¦**
   - æ¨™ç±¤åˆ†é¡åŠŸèƒ½
   - æŸ¥è©¢æ€§èƒ½æ¸¬è©¦
   - éŒ¯èª¤è™•ç†é©—è­‰

2. **æ€§èƒ½ç›£æ§**
   - æŸ¥è©¢éŸ¿æ‡‰æ™‚é–“
   - è¨˜æ†¶é«”ä½¿ç”¨æƒ…æ³
   - éŒ¯èª¤ç‡ç›£æ§

3. **ç”¨æˆ¶é©—è­‰**
   - é—œéµç”¨æˆ¶æ¸¬è©¦
   - åé¥‹æ”¶é›†
   - å•é¡Œè¨˜éŒ„

---

## ğŸ“Š éƒ¨ç½²æª¢æŸ¥æ¸…å–®

### éƒ¨ç½²å‰æª¢æŸ¥
- [ ] è³‡æ–™åº«å“è³ªæ¸¬è©¦é€šé
- [ ] å‚™ä»½ç­–ç•¥ç¢ºèª
- [ ] å›æ»¾è¨ˆåŠƒæº–å‚™
- [ ] ç›£æ§å·¥å…·é…ç½®
- [ ] åœ˜éšŠé€šçŸ¥å®Œæˆ

### éƒ¨ç½²ä¸­æª¢æŸ¥
- [ ] æœå‹™æ­£å¸¸åœæ­¢
- [ ] è³‡æ–™åº«æˆåŠŸæ›¿æ›
- [ ] æ¬Šé™æ­£ç¢ºè¨­ç½®
- [ ] æœå‹™æˆåŠŸå•Ÿå‹•
- [ ] å¥åº·æª¢æŸ¥é€šé

### éƒ¨ç½²å¾Œæª¢æŸ¥
- [ ] åŠŸèƒ½æ¸¬è©¦é€šé
- [ ] æ€§èƒ½æŒ‡æ¨™æ­£å¸¸
- [ ] éŒ¯èª¤æ—¥èªŒæ¸…æ½”
- [ ] ç”¨æˆ¶åé¥‹æ”¶é›†
- [ ] ç›£æ§æ•¸æ“šç¢ºèª

---

## ğŸ”§ éƒ¨ç½²å·¥å…·

### 1. å¥åº·æª¢æŸ¥è…³æœ¬
```python
# quick_health_check.py
import sqlite3
import time

def health_check():
    start_time = time.time()
    conn = sqlite3.connect('/var/lib/prompt-scribe/tags.db')
    cursor = conn.cursor()
    
    # åŸºæœ¬é€£æ¥æ¸¬è©¦
    cursor.execute("SELECT COUNT(*) FROM tags_final")
    total_tags = cursor.fetchone()[0]
    
    # æ€§èƒ½æ¸¬è©¦
    cursor.execute("SELECT * FROM tags_final WHERE post_count > 1000000 LIMIT 10")
    high_freq_tags = cursor.fetchall()
    
    conn.close()
    
    response_time = time.time() - start_time
    
    return {
        'status': 'healthy' if response_time < 0.1 else 'slow',
        'total_tags': total_tags,
        'response_time': response_time,
        'high_freq_tags_count': len(high_freq_tags)
    }
```

### 2. å›æ»¾è…³æœ¬
```bash
#!/bin/bash
# rollback.sh

echo "é–‹å§‹å›æ»¾..."
systemctl stop prompt-scribe-app

if [ -f "/var/lib/prompt-scribe/tags_backup.db" ]; then
    cp /var/lib/prompt-scribe/tags_backup.db /var/lib/prompt-scribe/tags.db
    echo "è³‡æ–™åº«å›æ»¾å®Œæˆ"
else
    echo "éŒ¯èª¤: æ‰¾ä¸åˆ°å‚™ä»½æ–‡ä»¶"
    exit 1
fi

systemctl start prompt-scribe-app
echo "æœå‹™å·²é‡å•Ÿï¼Œå›æ»¾å®Œæˆ"
```

### 3. ç›£æ§è…³æœ¬
```python
# monitor.py
import sqlite3
import time
import logging

def monitor_database():
    while True:
        try:
            conn = sqlite3.connect('/var/lib/prompt-scribe/tags.db')
            cursor = conn.cursor()
            
            # ç›£æ§æŒ‡æ¨™
            cursor.execute("SELECT COUNT(*) FROM tags_final")
            total_tags = cursor.fetchone()[0]
            
            cursor.execute("SELECT AVG(classification_confidence) FROM tags_final")
            avg_confidence = cursor.fetchone()[0]
            
            conn.close()
            
            logging.info(f"ç›£æ§æ•¸æ“š: ç¸½æ¨™ç±¤æ•¸={total_tags}, å¹³å‡ä¿¡å¿ƒåº¦={avg_confidence:.3f}")
            
        except Exception as e:
            logging.error(f"ç›£æ§éŒ¯èª¤: {e}")
        
        time.sleep(300)  # æ¯5åˆ†é˜æª¢æŸ¥ä¸€æ¬¡
```

---

## ğŸš¨ é¢¨éšªç®¡ç†

### ä¸»è¦é¢¨éšª
1. **è³‡æ–™åº«æå£**: å‚™ä»½å’Œå›æ»¾æ©Ÿåˆ¶
2. **æ€§èƒ½ä¸‹é™**: æ€§èƒ½ç›£æ§å’Œé è­¦
3. **åŠŸèƒ½ç•°å¸¸**: åŠŸèƒ½æ¸¬è©¦å’Œé©—è­‰
4. **ç”¨æˆ¶å½±éŸ¿**: æ¼¸é€²å¼éƒ¨ç½²å’Œå¿«é€Ÿå›æ»¾

### é¢¨éšªç·©è§£
- **å®Œæ•´å‚™ä»½**: éƒ¨ç½²å‰å‰µå»ºå¤šå€‹å‚™ä»½
- **å¿«é€Ÿå›æ»¾**: è‡ªå‹•åŒ–å›æ»¾è…³æœ¬
- **ç›£æ§é è­¦**: å¯¦æ™‚æ€§èƒ½ç›£æ§
- **åˆ†éšæ®µéƒ¨ç½²**: é™ä½å½±éŸ¿ç¯„åœ

---

## ğŸ“ˆ æˆåŠŸæŒ‡æ¨™

### æŠ€è¡“æŒ‡æ¨™
- æŸ¥è©¢éŸ¿æ‡‰æ™‚é–“ < 50ms
- éŒ¯èª¤ç‡ < 0.1%
- è³‡æ–™åº«å¯ç”¨æ€§ > 99.9%
- è¨˜æ†¶é«”ä½¿ç”¨ < 80%

### æ¥­å‹™æŒ‡æ¨™
- ç”¨æˆ¶æ»¿æ„åº¦ > 90%
- åŠŸèƒ½ä½¿ç”¨ç‡æ­£å¸¸
- æŠ•è¨´æ•¸é‡ < 5%
- ç³»çµ±ç©©å®šæ€§è‰¯å¥½

---

## ğŸ“ è¯çµ¡è³‡è¨Š

**éƒ¨ç½²è² è²¬äºº**: [å¾…æŒ‡å®š]  
**æŠ€è¡“æ”¯æ´**: [å¾…æŒ‡å®š]  
**ç·Šæ€¥è¯çµ¡**: [å¾…æŒ‡å®š]  

**éƒ¨ç½²æ™‚é–“çª—å£**: [å¾…å•†å®š]  
**é è¨ˆéƒ¨ç½²æ™‚é•·**: 30-60 åˆ†é˜  
**å›æ»¾æ™‚é–“**: < 5 åˆ†é˜  

---

## ğŸ“ éƒ¨ç½²è¨˜éŒ„

### éƒ¨ç½²æ­·å²
| ç‰ˆæœ¬ | æ—¥æœŸ | ç‹€æ…‹ | å‚™è¨» |
|------|------|------|------|
| v1.0 | 2025-10-13 | å¾…éƒ¨ç½² | åˆå§‹ç”Ÿç”¢ç‰ˆæœ¬ |

### å•é¡Œè¨˜éŒ„
- [å¾…è¨˜éŒ„éƒ¨ç½²éç¨‹ä¸­çš„å•é¡Œå’Œè§£æ±ºæ–¹æ¡ˆ]

---

*æ­¤æ–‡æª”å°‡åœ¨éƒ¨ç½²éç¨‹ä¸­æŒçºŒæ›´æ–°*
